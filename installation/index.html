<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <title>Installation - cfgov-refresh</title>
    
    

    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/syntax.css">
    

    <style type="text/css">
        
        .sidebar-nav a:hover,
        .sidebar-nav a:focus,
        .sidebar-nav a:active,
        .sidebar-nav a.sidebar-nav-active {
            border-left-color: #2CB34A;
        }
        header {
            border-bottom-color: #2CB34A;
        }
        
        

        
    </style>


    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
      <script src="../js/respond.min.js"></script>
    <![endif]--> 
</head>

<body>

    <div class="container">
        <header role="banner">
            <div class="wrap">
                
                <img class="logo" src="https://cfpb.github.io/img/logo_210.png" alt="Consumer Financial Protection Bureau">
                
                <h1 class="site-title"><a class="title-link" href="../">cfgov-refresh</a></h1>
            </div>
        </header>

        <div class="wrap content">
            <aside>
                <nav class="sidebar-nav" role="navigation">
                    <ul>
                        
                        <li>
                            
                            <a href=".." class="">Introduction</a>

                            
                        </li>
                        
                        <li>
                            
                            <a href="./" class="sidebar-nav-active">Installation</a>

                            
                        </li>
                        
                        <li>
                            
                            <a href="../usage/" class="">Usage</a>

                            
                        </li>
                        
                        <li>
                            
                            <span>Building and Deploying for cf.gov</span>
                            <ul class="secondary-nav">
                                
                                <li>
                                    <a href="../whats-new/" class="">What's new</a>
                                </li>
                                
                                <li>
                                    <a href="../new-projects/" class="">New projects</a>
                                </li>
                                
                                <li>
                                    <a href="../branching-merging/" class="">Branching and merging</a>
                                </li>
                                
                                <li>
                                    <a href="../release-cadence/" class="">Release cadence</a>
                                </li>
                                
                                <li>
                                    <a href="../deployment/" class="">Deployment</a>
                                </li>
                                
                                <li>
                                    <a href="../feature-flags/" class="">Feature flags</a>
                                </li>
                                
                            </ul>
                            
                        </li>
                        
                        <li>
                            
                            <span>Back-end guidelines</span>
                            <ul class="secondary-nav">
                                
                                <li>
                                    <a href="../wagtail-migrations/" class="">Wagtail and Django migrations</a>
                                </li>
                                
                                <li>
                                    <a href="../django-to-wagtail/" class="">Wagtail Pages vs Django views</a>
                                </li>
                                
                                <li>
                                    <a href="../translation/" class="">Translation</a>
                                </li>
                                
                            </ul>
                            
                        </li>
                        
                        <li>
                            
                            <span>Front-end guidelines</span>
                            <ul class="secondary-nav">
                                
                                <li>
                                    <a href="../atomic-structure/" class="">Atomic structure and design</a>
                                </li>
                                
                                <li>
                                    <a href="../notes-on-atomic-design/" class="">Notes on adapting atomic design</a>
                                </li>
                                
                                <li>
                                    <a href="../notes-on-frameworks/" class="">Notes on frameworks</a>
                                </li>
                                
                            </ul>
                            
                        </li>
                        
                        <li>
                            
                            <a href="../testing/" class="">Testing</a>

                            
                        </li>
                        
                        <li>
                            
                            <a href="../development-tips/" class="">Development tips</a>

                            
                        </li>
                        
                    </ul>
                </nav>
            </aside>

            <section id="main" class="main-content" role="main">
                <h1 id="installation-and-configuration-for-cfgov-refresh">Installation and configuration for cfgov-refresh</h1>
<h2 id="clone-the-repository">Clone the repository</h2>
<p>Using the console, navigate to the root directory in which your projects live and clone this project's repository:</p>
<div class="highlight"><pre><span></span>git clone git@github.com:cfpb/cfgov-refresh.git
<span class="nb">cd</span> cfgov-refresh
</pre></div>


<p>You may also wish to fork the repository on GitHub and clone the resultant personal fork. This is advised if you are going to be doing development on <code>cfgov-refresh</code> and contributing to the project.</p>
<p>There are two ways to install cfgov-refresh:</p>
<ul>
<li><a href="#stand-alone-installation">Stand-alone installation</a></li>
<li><a href="#vagrant-box-installation">Vagrant-box installation</a></li>
</ul>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>The instruction for Vagrant are not currently working.</p>
</div>
<h2 id="stand-alone-installation">Stand-alone installation</h2>
<p>These instructions are somewhat specific to developing on Mac OS X,
but if you're familiar with other Unix-based systems,
it should be fairly easy to adapt them to your needs.</p>
<h3 id="install-system-level-requirements">Install system-level requirements</h3>
<h4 id="virtualenv-virtualenvwrapper-python-modules">virtualenv &amp; virtualenvwrapper Python modules</h4>
<p>Install <a href="https://virtualenv.pypa.io/en/latest/index.html">virtualenv</a>
and <a href="https://virtualenvwrapper.readthedocs.org/en/latest/">virtualenvwrapper</a>
to be able to create a local environment for your server:</p>
<div class="highlight"><pre><span></span>pip install virtualenv virtualenvwrapper
</pre></div>


<h4 id="autoenv-module">Autoenv module</h4>
<p>This project uses a large number of environment variables.</p>
<p>To automatically define environment variables and launch the virtualenv
upon <code>cd</code>ing to the project folder,
<a href="https://github.com/kennethreitz/autoenv#install">install Autoenv</a>.
We recommend using <a href="http://brew.sh">Homebrew</a>:</p>
<div class="highlight"><pre><span></span>brew install autoenv
</pre></div>


<p>After installation, Homebrew will output instructions similar to:</p>
<div class="highlight"><pre><span></span>To finish the installation, <span class="nb">source</span> activate.sh in your shell:
  <span class="nb">source</span> /Users/<span class="o">[</span>YOUR USERNAME<span class="o">]</span>/homebrew/opt/autoenv/activate.sh
</pre></div>


<p>Run that now for your initial setup.
Any time you run the project you’ll need to run that last line, so
if you’ll be working with the project consistently,
we suggest adding it to your Bash profile by running:</p>
<div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s1">&#39;source /Users/[YOUR USERNAME]/homebrew/opt/autoenv/activate.sh&#39;</span> &gt;&gt; ~/.bash_profile
</pre></div>


<p>If you need to find this info again later, you can run:</p>
<div class="highlight"><pre><span></span>brew info autoenv
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you use Zsh you’ll need to use
<a href="https://github.com/Tarrasch/zsh-autoenv">zsh-autoenv</a>,
but we can’t provide support for issues that may arise.</p>
</div>
<h4 id="mysql">MySQL</h4>
<p>If you're developing on OS X, this should be installed by default,
and you shouldn't have to do anything else to get it working.
You can optionally install a different version with Homebrew.</p>
<h4 id="elasticsearch">Elasticsearch</h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>These instructions are deprecated since Elasticsearch 1.7
is no longer supported by <code>brew</code>.</strong></p>
</div>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/setup.html">Install Elasticsearch 1.7</a>
however you’d like. We use <a href="http://brew.sh">Homebrew</a> for developing on OS X):</p>
<div class="highlight"><pre><span></span>brew tap homebrew/versions
brew search elasticsearch
brew install homebrew/versions/elasticsearch17
</pre></div>


<p>Just as with Autoenv, Homebrew will output similar instructions after installation:</p>
<div class="highlight"><pre><span></span><span class="c1"># To have launchd start homebrew/versions/elasticsearch17 now and restart at login:</span>
  brew services start homebrew/versions/elasticsearch17
<span class="c1"># Or, if you don&#39;t want/need a background service you can just run:</span>
  elasticsearch --config<span class="o">=</span>/Users/<span class="o">[</span>YOUR USERNAME<span class="o">]</span>/homebrew/opt/elasticsearch17/config/elasticsearch.yml
</pre></div>


<p>Any time you resume work on the project after restarting your machine,
you’ll need to open a new tab and run that last line.
If you’ll be working on the project consistently,
we suggest using the first option, so you don't have to worry about that.
Note that some older versions of Homebrew may suggest
using <code>launchctl</code> instead of <code>brew services</code>.</p>
<p>If you need to find this info again later, you can run:</p>
<div class="highlight"><pre><span></span>brew info elasticsearch17
</pre></div>


<h4 id="front-end-dependencies">Front-end dependencies</h4>
<p>The cfgov-refresh front end currently uses the following frameworks / tools:</p>
<ul>
<li><a href="http://gulpjs.com">Gulp</a>: task management for pulling in assets,
  linting and concatenating code, etc.</li>
<li><a href="http://lesscss.org">Less</a>: CSS pre-processor.</li>
<li><a href="https://cfpb.github.io/capital-framework/getting-started">Capital Framework</a>:
  User interface pattern-library produced by the CFPB.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you’re new to Capital Framework, we encourage you to
<a href="https://cfpb.github.io/capital-framework/getting-started">start here</a>.</p>
</div>
<ol>
<li>
<p>Install <a href="http://nodejs.org">Node.js</a> however you’d like.
   We recommend using <a href="https://github.com/creationix/nvm">nvm</a>, though.</p>
</li>
<li>
<p>Install <a href="http://gulpjs.com">Gulp</a>:</p>
</li>
</ol>
<div class="highlight"><pre><span></span>npm install -g gulp
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This project requires Node.js v5.5 or higher, and npm v3 or higher.</p>
</div>
<h4 id="set-up-your-environment">Set up your environment</h4>
<p>If this is the first time you're setting up the project, run the following
script to copy <code>.env_SAMPLE</code> to <code>.env</code>, export your environment variables,
and activate your virtualenv for the first time.</p>
<div class="highlight"><pre><span></span><span class="nb">source</span> load-env.sh
</pre></div>


<p>Each time you start a new session for working on this project, you'll need to
get those environment variables and get your virtualenv running again.
If you setup Autoenv earlier, this will happen for you automatically when you
<code>cd</code> into the project directory.</p>
<p>If you prefer not to use Autoenv, just be sure to <code>source .env</code> every time
you start a new session of work on the project.</p>
<h4 id="run-the-setup-script">Run the setup script</h4>
<p>At this point, your machine should have everything it needs to automate the
rest of the setup process.</p>
<p>If you haven't cloned this repo yet, clone it to a local folder.
Because related projects will need to be installed as siblings to this project,
we recommend putting them all in their own folder, e.g., <code>~/Projects/cf.gov</code>.</p>
<p>Once cloned, from the project root (<code>~/Projects/cf.gov/cfgov-refresh/</code>),
run this command to complete the setup process:</p>
<div class="highlight"><pre><span></span><span class="nb">source</span> setup.sh
</pre></div>


<p>This will take several minutes, going through the steps in these scripts:</p>
<ol>
<li><code>frontend.sh</code></li>
<li><code>backend.sh</code></li>
</ol>
<p>Once complete, you should have a fully functioning local environment,
ready for you to develop against!</p>
<p>There are some <a href="#optional-steps">optional setup steps</a>
that you may want to perform before continuing.</p>
<p>Want to know more about what the setup scripts are doing?
<a href="#curious-about-what-the-setup-scripts-are-doing">Read the detailed rundown.</a></p>
<p>Get any errors? <a href="#troubleshooting">See our troubleshooting tips.</a></p>
<p><strong>Continue following the <a href="../usage">usage instructions</a>.</strong></p>
<h2 id="vagrant-box-installation">Vagrant-box installation</h2>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>These instructions are not currently working, but we'd like to get them working soon. <a href="../contributing">PRs welcome</a>.</p>
</div>
<h3 id="1-environment-variables-setup">1. Environment variables setup</h3>
<p>The project uses a number of environment variables.
The <code>setup.sh</code> script will create a <code>.env</code> file for you
from the <code>.env_SAMPLE</code> file found in the repository,
if you don't already have one.</p>
<p>Inside the <code>.env</code> file you can customize the project environment configuration.</p>
<p>If you would like to manually copy the environment settings,
copy the <code>.env_SAMPLE</code> file and un-comment each variable after
adding your own values.
<div class="highlight"><pre><span></span>cp -a .env_SAMPLE .env <span class="o">&amp;&amp;</span> open -t .env
</pre></div>
</p>
<p>Then load the environment variables with:
<div class="highlight"><pre><span></span>. ./.env
</pre></div>
</p>
<h3 id="2-fetch-extra-playbooks">2. Fetch extra playbooks</h3>
<p>The project pulls together various open source and closed source plays. The plays are
managed through ansible-galaxy, a core module for this exact purpose. To download all
the dependencies, use this command:</p>
<div class="highlight"><pre><span></span>ansible-galaxy install -r ansible/requirements.yml
</pre></div>


<h3 id="3-launch-vagrant-virtual-environment">3. Launch Vagrant virtual environment</h3>
<p>The project uses Vagrant to create the simulated virtual environment allowing the developer
to work on a production-like environment while maintaining development work on the
local machine. To create this virtual environment, you need to execute the following command.</p>
<div class="highlight"><pre><span></span>vagrant up
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please be patient the first time you run this step.</p>
</div>
<h3 id="4-front-end-tools">4. Front-end Tools</h3>
<p>In order to run the application, we must generate the front-end assets.
After running the following commands, visit <a href="http://localhost:8001">http://localhost:8001</a> to see the site running.
You can also place the first two export commands into your <code>.bashrc</code> to simplify things later.</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">CFGOV_HOME</span><span class="o">=</span>path/to/cfgov-refresh
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$CFGOV_HOME</span>/bin
cfgov init
cfgov assets
cfgov start django
</pre></div>


<h2 id="optional-steps">Optional steps</h2>
<h3 id="load-initial-data-into-database">Load initial data into database</h3>
<p>The <code>initial-data.sh</code> script can be used to initialize a new database to make
it easy to get started working on Wagtail. This script first ensures that all
migrations are applied to the database, and then does the following:</p>
<ul>
<li>Creates an <code>admin</code> superuser with a password as specified in the
<code>WAGTAIL_ADMIN_PW</code> environment variable, if set.</li>
<li>If it doesn't already exist, creates a new Wagtail home page named <code>CFGOV</code>,
with a slug of <code>cfgov</code>.</li>
<li>Updates the default Wagtail site to use the port defined by the <code>DJANGO_HTTP_PORT</code> environment variable, if defined; otherwise this port is set to 80.</li>
<li>If it doesn't already exist, creates a new <a href="https://github.com/cfpb/wagtail-sharing">wagtail-sharing</a> <code>SharingSite</code> with a hostname and port defined by the <code>DJANGO_STAGING_HOSTNAME</code> and <code>DJANGO_HTTP_PORT</code> environment variables.</li>
</ul>
<h3 id="load-a-database-dump">Load a database dump</h3>
<p>If you're installing this fresh, the initial data you receive will not be
as extensive as you'd probably like it to be.</p>
<p>You can get a database dump by:</p>
<ol>
<li>Going to [GHE]/CFGOV/platform/wiki/Database-downloads</li>
<li>Selecting one of the extractions and downloading the <code>production_django.sql.gz</code> file</li>
<li>Unzip it</li>
<li>Run:</li>
</ol>
<div class="highlight"><pre><span></span>./refresh-data.sh /path/to/dump.sql
</pre></div>


<p>The <code>refresh-data.sh</code> script will apply the same changes as the <code>initial-data.sh</code> script described above (including setting up the <code>admin</code> superuser), but will not apply migrations.</p>
<p>To apply any unapplied migrations to a database created from a dump, run:</p>
<div class="highlight"><pre><span></span>python cfgov/manage.py migrate
</pre></div>


<h3 id="install-dependencies-for-working-with-the-govdelivery-api">Install dependencies for working with the GovDelivery API</h3>
<p>Install the following GovDelivery dependencies into your virtual environment:</p>
<div class="highlight"><pre><span></span>pip install git+git://github.com/dpford/flask-govdelivery
pip install git+git://github.com/rosskarchner/govdelivery
</pre></div>


<p>Uncomment and set the GovDelivery environment variables in your <code>.env</code> file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>GovDelivery is a third-party web service that powers our emails.
The API is used by subscribe forms on our website.
Users may decide to swap this tool out for another third-party service.</p>
</div>
<h2 id="curious-about-what-the-setup-scripts-are-doing">Curious about what the setup scripts are doing?</h2>
<p>Here's a rundown of each of the scripts called by <code>setup.sh</code> and what they do.</p>
<h3 id="1-frontendsh">1. <code>frontend.sh</code></h3>
<ol>
<li><strong>Initialize project dependency directories</strong> (<code>init</code>)</li>
</ol>
<p>This script first checks for an argument passed from the command line
   that can trigger different options for different environments.
   Since you ran it with no arguments, it will set up the dev environment.</p>
<p>It will then set some env vars for the Node and Bower dependency directories.
1. <strong>Clean project dependencies</strong> (<code>clean</code>)</p>
<p>The script will now empty out all installed dependencies,
   so the new installation can start fresh.
1. <strong>Install project dependencies</strong> (<code>install</code>)</p>
<p>Node and Bower dependencies are installed.
   The <code>devDependencies</code> from <code>package.json</code> are not installed
   if the environment is production, and if it's the dev or test environment,
   it checks to see if Protractor is globally installed.
1. <strong>Run tasks to build the project for distribution</strong> (<code>build</code>)</p>
<p>Finally, the script executes <code>gulp clean</code> to wipe out any lingering
   <code>dist</code> files, then runs <code>gulp build</code> to rebuild everything.</p>
<h3 id="2-backendsh">2. <code>backend.sh</code></h3>
<ol>
<li><strong>Confirm environment</strong> (<code>init</code>)</li>
</ol>
<p>This script first checks for an argument passed from the command line
   that can trigger different options for different environments.
   Since you ran it with no arguments, it will set up the dev environment.</p>
<p>It will then run a script to ensure that you're in a virtualenv.
   If not, the script will end, to prevent you from accidentally installing
   your Python dependencies globally.
1. <strong>Install project dependencies</strong> (<code>install</code>)</p>
<p>Python dependencies are installed into the virtualenv via pip.
   Dependencies vary slightly depending on whether we're in dev, test, or prod.
1. <strong>Setup MySQL server</strong> (<code>db_setup</code>)</p>
<p>Finally, the script will start the MySQL server, if it's not already running,
   run <code>create-mysql-db.sh</code> to create the database using
   the variables given in <code>.env</code>, if it's not already there,
   and will run <code>initial-data.sh</code> to create the first Wagtail user
   and load some basic initial data.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>Here are some common issues and how you can fix them:</p>
<h3 id="errors-referencing-south-or-other-python-errors">Errors referencing South, or other Python errors:</h3>
<p>Since moving to Django 1.8, we use Django's built-in migration engine,
and we no longer use South.
If you're getting South errors, you probably have it installed globally.
To solve this, from outside the virtual environment, run <code>pip uninstall south</code>.</p>
<p>If you're getting other kinds of Python errors (for example, when running tox),
you may even want to go as far as uninstalling all globally-installed
Python packages: <code>pip freeze | grep -v "^-e" | xargs pip uninstall -y</code>.
After doing that, you'll need to reinstall virtualenv:
<code>pip install virtualenv virtualenvwrapper</code>.</p>
            </section>
        </div>

        <footer role="contentinfo">
            <div class="wrap">
                This project is maintained by <a href="https://cfpb.github.io">The Consumer Financial Protection Bureau</a>.

                <p>Hosted on <a href="http://pages.github.com/">GitHub Pages</a>.</p>
            </div>
        </footer>
    </div>
</body>
</html>
